<?php$flag = false;$hash = $_GET['ident'];$fid = floor($_GET['fileID']*17/300);require( '../../../wp-blog-header.php' );$dateiname = get_option('downloadPerPaypal_dateiName');global $wpdb;		$prefix = $wpdb->prefix;	$result = $wpdb->get_results("SELECT id,email,filePath,timestamp FROM $prefix" . "downloadPerPaypal");		foreach ($result as $pointer) {		$id = $pointer->id;		$email = $pointer->email;		$path = $pointer->filePath;		if($fid == $id){									if (md5($email . 'md5hashsalt') === $hash) {							$flag = false;				$filename = "../../../" . $path;				$path_parts = pathinfo($filename);				$endung = $path_parts['extension'];								if (file_exists($filename)) {									header("Expires: Mon, 26 Jul 1997 05:00:00 GMT;\n");					header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT;\n");					header("Content-Transfer-Encoding: binary;\n");					$len = filesize($filename);					header("Content-Length: $len;\n");										// Wir werden eineDatei ausgeben					header("Content-type: application/$endung;\n");					// Es wird umbenannt					header('Content-Disposition: attachment; filename="' . $dateiname. '.' . $endung . '";\n');										$flag = false;					// Die originale  Datei					readfile($filename);					break;				} else {					echo 'Datei nicht erreichbar oder keine g&uuml;ltige Datei angegeben!';				}						}          // des Arrays auszugeben			else {			$flag = true;			}					}		else {			$flag = true;		}	}if($flag) echo "Leider keine Befugnis! Gesch&uuml;tzte Inhalte";?>